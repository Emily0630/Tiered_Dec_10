# Contextual Bandit with Surrogate Outcomes
This repository contains the code for bandit methods using surrogate outcomes.

## Running Guide

### Run locally
```{bash}
conda env create --file=python_env_all_platforms.yml
source activate surrogate_bandit 
export PYTHONPATH="${PYTHONPATH}:{PATH_TO_CURRENT_DIRECTORY}"
python ./scripts/comparisons.py
```

Use conda/pip to install other dependencies

Results csv files are in results2/...

### Run on HPC
```{bash}
ssh {netID}@dcc-login.oit.duke.edu
git clone ...
conda env create --file=python_env_all_platforms.yml
source activate surrogate_bandit 
export PYTHONPATH="${PYTHONPATH}:/hpc/home/{netID}/cb_surrogates"
sbatch shells/simulate_comparisons_48.sh
```

Results csv files are in results2/...

System outputs are in outputs/...

## Environment setup
This project uses miniconda for mangaging the python environment. To recreate the python environment with the required packages run:

```{python}
conda env create -f python_env.yml
```

For details on installing miniconda see the following [link](https://docs.conda.io/en/latest/miniconda.html).

Other external dependencies are:
- gurobi (Academic license or better required at the moment). For setting up an gurobi academic license please use the following [link](https://www.gurobi.com/downloads/end-user-license-agreement-academic/).


These methods are implemented in python. The relevant scripts are stored in /src. To access these methods we create a module from src. Once the the environemnt is setup activate your conda environment and run the folowing command from the head directory to make the module avaible:

```{bash}
pip install -e .
```
  

## Project Structure

### /src
The src folder contains all the code for the python implmentation.
- **stategies.py**: contains the implementations for the various bandit algorithms incorporating surrogate outcomes.
- **monotonic_tree.py**: contains code for fitting a constrained regression using a high dimensional featue vector generated by a random forest embedding.
- **generative_models.py**: contains code for simulatting bandit environments to be used in simulations.
- **orders.py**: contains functions for possible partial orders that are defined over the surrogate outcome space.
- **bandit_data.py**: contains an object that represents data coming from a contextual bandit
- **policy.py**: creates a class of linear policies.


### /scripts 
Python scripts for running simulations using the methods stored in /src
- **regression_simulations.py**: runs simulations to compare the performance of the monotone tree embedded regressor with surrogate constraints, the monotone tree embedded regressor without constraints, and ridge regression.

### R
Implementation of the policy screening method in R.  Unfinished at the moment.